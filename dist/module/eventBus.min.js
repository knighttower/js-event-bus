class EventBus{constructor(){this.listeners={}}on(e,t){this.registerListener(e,t)}once(e,t){this.registerListener(e,t,1)}exactly(e,t,s){this.registerListener(e,t,s)}off(e){delete this.listeners[e]}detach(e,t){const s=(this.listeners[e]||[]).filter((function(e){return e.callback!==t}));return e in this.listeners&&(this.listeners[e]=s,!0)}emit(e,...t){let s=[],r=null;const i=this.extractContextFromArgs(t),n=i[0];if(t=i[1],this.hasListener(e))s=this.listeners[e];else if(e.includes("*"))r=this.patternSearch(e,Object.keys(this.listeners)),r&&r.forEach((e=>{s=s.concat(this.listeners[e])}));else for(const t in this.listeners)r=this.patternSearch(t,[e]),r&&(s=s.concat(this.listeners[t]));s.forEach(((r,i)=>{let l=r.callback;n&&(l=l.bind(n)),l(...t),void 0!==r.triggerCapacity&&(r.triggerCapacity--,s[i].triggerCapacity=r.triggerCapacity),this.checkToRemoveListener(r)&&this.listeners[e].splice(i,1)}))}patternSearch(e,t){let s=[];const r=new RegExp(this.setWildCardString(e));return s=t.filter((e=>r.test(e))),0===s.length?null:s}setWildCardString(e){let t=e.replace(/([.+?^${}()|\[\]\/\\])/g,"\\$&");return t=t.replace(/\*\*/g,"[_g_]").replace(/\*/g,"(.*?)").replace(/\[_g_\]/g,".*"),`^${t}$`}extractContextFromArgs(e){let t=null;for(let s=0;s<e.length;s++){const r=e[s];if(r&&"object"==typeof r&&r.hasOwnProperty("__context")){t=r.__context,e.splice(s,1);break}}return[t,e]}registerListener(e,t,s){this.hasListener(e)||(this.listeners[e]=[]),this.listeners[e].push({callback:t,triggerCapacity:s})}checkToRemoveListener(e){return void 0!==e.triggerCapacity&&e.triggerCapacity<=0}hasListener(e){return e in this.listeners}}function _eventBus(){return"undefined"!=typeof window?(window.eventBus||(window.eventBus=new EventBus),window.eventBus):"undefined"!=typeof global?(global.eventBus||(global.eventBus=new EventBus),global.eventBus):new EventBus}export{EventBus,EventBus as default,_eventBus};