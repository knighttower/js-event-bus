class EventBus{constructor(){this.listeners={}}on(e,t){this.registerListener(e,t)}once(e,t){this.registerListener(e,t,1)}exactly(e,t,s){this.registerListener(e,t,s)}off(e){delete this.listeners[e]}detach(e,t){const s=(this.listeners[e]||[]).filter((function(e){return e.callback!==t}));return e in this.listeners&&(this.listeners[e]=s,!0)}emit(e,...t){let s=[],i=null;const r=this.extractContextFromArgs(t),n=r[0];if(t=r[1],this.hasListener(e))s=this.listeners[e];else if(e.includes("*"))i=this.patternSearch(e,Object.keys(this.listeners)),i&&i.forEach((e=>{s=s.concat(this.listeners[e])}));else for(const t in this.listeners)i=this.patternSearch(t,[e]),i&&(s=s.concat(this.listeners[t]));s.forEach(((i,r)=>{let l=i.callback;n&&(l=l.bind(n)),l(...t),void 0!==i.triggerCapacity&&(i.triggerCapacity--,s[r].triggerCapacity=i.triggerCapacity),this.checkToRemoveListener(i)&&this.listeners[e].splice(r,1)}))}patternSearch(e,t){let s=[];const i=new RegExp(this.setWildCardString(e));return s=t.filter((e=>i.test(e))),0===s.length?null:s}setWildCardString(e){let t=e.replace(/([.+?^${}()|\[\]\/\\])/g,"\\$&");return t=t.replace(/\*\*/g,"[_g_]").replace(/\*/g,"(.*?)").replace(/\[_g_\]/g,".*"),`^${t}$`}extractContextFromArgs(e){let t=null;for(let s=0;s<e.length;s++){const i=e[s];if(i&&"object"==typeof i&&i.hasOwnProperty("__context")){t=i.__context,e.splice(s,1);break}}return[t,e]}registerListener(e,t,s){this.hasListener(e)||(this.listeners[e]=[]),this.listeners[e].push({callback:t,triggerCapacity:s})}checkToRemoveListener(e){return void 0!==e.triggerCapacity&&e.triggerCapacity<=0}hasListener(e){return e in this.listeners}}function eventBus(){return"undefined"!=typeof window?(window.eventBus||(window.eventBus=new EventBus),window.eventBus):"undefined"!=typeof global?(global.eventBus||(global.eventBus=new EventBus),global.eventBus):new EventBus}